[
  {
    "id": "TC_001",
    "scenario": "download_last_invoice_pdf",
    "query": "Hola, ¿me puedes enviar el PDF de mi última factura de Movistar? Mi línea es +34 612 345 678.",
    "available_tools": [
      {
        "type": "function",
        "function": {
          "name": "get_customer_by_msisdn",
          "description": "Finds a Movistar customer account using a mobile line (MSISDN).",
          "parameters": {
            "type": "object",
            "properties": {
              "msisdn": {
                "type": "string",
                "description": "Mobile number in E.164 format, e.g., +346XXXXXXXX"
              }
            },
            "required": [
              "msisdn"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_latest_invoice",
          "description": "Retrieves the most recent invoice metadata for a given account.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              }
            },
            "required": [
              "account_id"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "download_invoice_pdf",
          "description": "Generates a secure download link for an invoice PDF.",
          "parameters": {
            "type": "object",
            "properties": {
              "invoice_id": {
                "type": "string",
                "description": "Invoice identifier"
              },
              "delivery_channel": {
                "type": "string",
                "description": "Where to deliver the link: 'chat' or 'email'"
              }
            },
            "required": [
              "invoice_id",
              "delivery_channel"
            ]
          }
        }
      }
    ],
    "expected_tool_calls": [
      "get_customer_by_msisdn",
      "get_latest_invoice",
      "download_invoice_pdf"
    ],
    "expected_parameters": {
      "get_customer_by_msisdn": {
        "msisdn": "+34612345678"
      },
      "get_latest_invoice": {
        "account_id": "ACC_FROM_MSISDN"
      },
      "download_invoice_pdf": {
        "invoice_id": "LATEST_INVOICE_ID",
        "delivery_channel": "chat"
      }
    },
    "complexity": "high"
  },
  {
    "id": "TC_002",
    "scenario": "explain_roaming_charges",
    "query": "En mi factura de enero me han cobrado 18,50€ por 'Roaming datos'. ¿Me puedes decir de qué es y en qué días se generó? Mi DNI es 12345678Z.",
    "available_tools": [
      {
        "type": "function",
        "function": {
          "name": "get_account_by_document",
          "description": "Looks up the billing account using a Spanish document number (DNI/NIE).",
          "parameters": {
            "type": "object",
            "properties": {
              "document_type": {
                "type": "string",
                "description": "Document type: DNI or NIE"
              },
              "document_number": {
                "type": "string",
                "description": "Document number, e.g., 12345678Z"
              }
            },
            "required": [
              "document_type",
              "document_number"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_invoice_by_period",
          "description": "Fetches invoice metadata for a given billing period.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              },
              "billing_period": {
                "type": "string",
                "description": "Billing period in YYYY-MM format"
              }
            },
            "required": [
              "account_id",
              "billing_period"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_invoice_itemization",
          "description": "Returns detailed line items (calls, data, roaming, services) for an invoice.",
          "parameters": {
            "type": "object",
            "properties": {
              "invoice_id": {
                "type": "string",
                "description": "Invoice identifier"
              },
              "category_filter": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Optional categories to filter, e.g., ['roaming']"
              }
            },
            "required": [
              "invoice_id"
            ]
          }
        }
      }
    ],
    "expected_tool_calls": [
      "get_account_by_document",
      "get_invoice_by_period",
      "get_invoice_itemization"
    ],
    "expected_parameters": {
      "get_account_by_document": {
        "document_type": "DNI",
        "document_number": "12345678Z"
      },
      "get_invoice_by_period": {
        "account_id": "ACC_FROM_DOCUMENT",
        "billing_period": "2026-01"
      },
      "get_invoice_itemization": {
        "invoice_id": "INVOICE_2026_01_ID",
        "category_filter": [
          "roaming"
        ]
      }
    },
    "complexity": "medium"
  },
  {
    "id": "TC_003",
    "scenario": "update_invoice_email_delivery",
    "query": "Quiero que a partir de ahora me lleguen las facturas al correo nuevo: ana.perez+nuevo@gmail.com. Mi número fijo es 915 123 456.",
    "available_tools": [
      {
        "type": "function",
        "function": {
          "name": "get_account_by_landline",
          "description": "Finds the billing account associated with a landline number.",
          "parameters": {
            "type": "object",
            "properties": {
              "landline_number": {
                "type": "string",
                "description": "Spanish landline number"
              }
            },
            "required": [
              "landline_number"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "update_billing_contact",
          "description": "Updates billing contact details such as email and postal address.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              },
              "email": {
                "type": "string",
                "description": "New billing email address"
              },
              "send_paper_invoice": {
                "type": "boolean",
                "description": "Whether to keep receiving paper invoices"
              }
            },
            "required": [
              "account_id",
              "email"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_billing_preferences",
          "description": "Retrieves current billing delivery preferences for an account.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              }
            },
            "required": [
              "account_id"
            ]
          }
        }
      }
    ],
    "expected_tool_calls": [
      "get_account_by_landline",
      "update_billing_contact"
    ],
    "expected_parameters": {
      "get_account_by_landline": {
        "landline_number": "915123456"
      },
      "update_billing_contact": {
        "account_id": "ACC_FROM_LANDLINE",
        "email": "ana.perez+nuevo@gmail.com"
      }
    },
    "complexity": "medium"
  },
  {
    "id": "TC_004",
    "scenario": "no_tool_due_date_explanation",
    "query": "¿Cuál es la diferencia entre 'fecha de emisión' y 'fecha de vencimiento' en la factura de Movistar? Me lío con cuándo tengo que pagar.",
    "available_tools": [
      {
        "type": "function",
        "function": {
          "name": "get_latest_invoice",
          "description": "Retrieves the most recent invoice metadata for a given account.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              }
            },
            "required": [
              "account_id"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_payment_status",
          "description": "Checks whether an invoice is paid, pending, or overdue.",
          "parameters": {
            "type": "object",
            "properties": {
              "invoice_id": {
                "type": "string",
                "description": "Invoice identifier"
              }
            },
            "required": [
              "invoice_id"
            ]
          }
        }
      }
    ],
    "expected_tool_calls": [],
    "expected_parameters": {},
    "complexity": "low"
  },
  {
    "id": "TC_005",
    "scenario": "missing_required_invoice_period",
    "query": "Necesito que me digas el importe total de mi factura, pero no recuerdo de qué mes era. Mi DNI es X1234567T.",
    "available_tools": [
      {
        "type": "function",
        "function": {
          "name": "get_account_by_document",
          "description": "Looks up the billing account using a Spanish document number (DNI/NIE).",
          "parameters": {
            "type": "object",
            "properties": {
              "document_type": {
                "type": "string",
                "description": "Document type: DNI or NIE"
              },
              "document_number": {
                "type": "string",
                "description": "Document number, e.g., X1234567T"
              }
            },
            "required": [
              "document_type",
              "document_number"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_invoice_by_period",
          "description": "Fetches invoice metadata for a given billing period.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              },
              "billing_period": {
                "type": "string",
                "description": "Billing period in YYYY-MM format"
              }
            },
            "required": [
              "account_id",
              "billing_period"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_latest_invoice",
          "description": "Retrieves the most recent invoice metadata for a given account.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              }
            },
            "required": [
              "account_id"
            ]
          }
        }
      }
    ],
    "expected_tool_calls": [
      "get_account_by_document"
    ],
    "expected_parameters": {
      "get_account_by_document": {
        "document_type": "NIE",
        "document_number": "X1234567T"
      }
    },
    "complexity": "low"
  },
  {
    "id": "TC_006",
    "scenario": "ambiguous_refund_or_claim",
    "query": "Me han cobrado un servicio que no he contratado y quiero que me lo devuelvan. Es de 9,99€ y pone 'Servicios digitales'.",
    "available_tools": [
      {
        "type": "function",
        "function": {
          "name": "create_billing_claim",
          "description": "Creates a formal billing dispute/claim for an invoice charge.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              },
              "invoice_id": {
                "type": "string",
                "description": "Invoice identifier"
              },
              "amount": {
                "type": "number",
                "description": "Disputed amount"
              },
              "reason": {
                "type": "string",
                "description": "Reason for the claim"
              }
            },
            "required": [
              "account_id",
              "invoice_id",
              "amount",
              "reason"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "request_refund",
          "description": "Requests a refund for a specific invoice charge when eligible.",
          "parameters": {
            "type": "object",
            "properties": {
              "invoice_id": {
                "type": "string",
                "description": "Invoice identifier"
              },
              "charge_code": {
                "type": "string",
                "description": "Charge identifier/code within the invoice"
              },
              "amount": {
                "type": "number",
                "description": "Refund amount"
              }
            },
            "required": [
              "invoice_id",
              "charge_code",
              "amount"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_invoice_itemization",
          "description": "Returns detailed line items (calls, data, roaming, services) for an invoice.",
          "parameters": {
            "type": "object",
            "properties": {
              "invoice_id": {
                "type": "string",
                "description": "Invoice identifier"
              },
              "category_filter": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Optional categories to filter, e.g., ['digital_services']"
              }
            },
            "required": [
              "invoice_id"
            ]
          }
        }
      }
    ],
    "expected_tool_calls": [],
    "expected_parameters": {},
    "complexity": "medium"
  },
  {
    "id": "TC_007",
    "scenario": "split_bill_by_lines",
    "query": "Tengo 3 líneas en el mismo contrato y quiero ver cuánto ha consumido cada una en la factura de 2025-12. El titular es con DNI 87654321A.",
    "available_tools": [
      {
        "type": "function",
        "function": {
          "name": "get_account_by_document",
          "description": "Looks up the billing account using a Spanish document number (DNI/NIE).",
          "parameters": {
            "type": "object",
            "properties": {
              "document_type": {
                "type": "string",
                "description": "Document type: DNI or NIE"
              },
              "document_number": {
                "type": "string",
                "description": "Document number, e.g., 87654321A"
              }
            },
            "required": [
              "document_type",
              "document_number"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_invoice_by_period",
          "description": "Fetches invoice metadata for a given billing period.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              },
              "billing_period": {
                "type": "string",
                "description": "Billing period in YYYY-MM format"
              }
            },
            "required": [
              "account_id",
              "billing_period"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_invoice_breakdown_by_line",
          "description": "Provides invoice totals and usage grouped by each line under the account.",
          "parameters": {
            "type": "object",
            "properties": {
              "invoice_id": {
                "type": "string",
                "description": "Invoice identifier"
              },
              "include_usage_details": {
                "type": "boolean",
                "description": "Whether to include detailed usage (calls/data/SMS) per line"
              }
            },
            "required": [
              "invoice_id"
            ]
          }
        }
      }
    ],
    "expected_tool_calls": [
      "get_account_by_document",
      "get_invoice_by_period",
      "get_invoice_breakdown_by_line"
    ],
    "expected_parameters": {
      "get_account_by_document": {
        "document_type": "DNI",
        "document_number": "87654321A"
      },
      "get_invoice_by_period": {
        "account_id": "ACC_FROM_DOCUMENT",
        "billing_period": "2025-12"
      },
      "get_invoice_breakdown_by_line": {
        "invoice_id": "INVOICE_2025_12_ID",
        "include_usage_details": true
      }
    },
    "complexity": "high"
  },
  {
    "id": "TC_008",
    "scenario": "set_direct_debit_iban",
    "query": "Quiero domiciliar el pago de mis facturas en este IBAN: ES76 2100 0418 4502 0005 1332. Mi móvil es +34 699 111 222.",
    "available_tools": [
      {
        "type": "function",
        "function": {
          "name": "get_customer_by_msisdn",
          "description": "Finds a Movistar customer account using a mobile line (MSISDN).",
          "parameters": {
            "type": "object",
            "properties": {
              "msisdn": {
                "type": "string",
                "description": "Mobile number in E.164 format, e.g., +346XXXXXXXX"
              }
            },
            "required": [
              "msisdn"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "validate_iban",
          "description": "Validates an IBAN format and checksum.",
          "parameters": {
            "type": "object",
            "properties": {
              "iban": {
                "type": "string",
                "description": "IBAN to validate"
              }
            },
            "required": [
              "iban"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "set_direct_debit",
          "description": "Sets or updates the direct debit bank account for invoice payments.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              },
              "iban": {
                "type": "string",
                "description": "IBAN for direct debit"
              },
              "consent": {
                "type": "boolean",
                "description": "Customer consent to use this IBAN for SEPA direct debit"
              }
            },
            "required": [
              "account_id",
              "iban",
              "consent"
            ]
          }
        }
      }
    ],
    "expected_tool_calls": [
      "validate_iban",
      "get_customer_by_msisdn",
      "set_direct_debit"
    ],
    "expected_parameters": {
      "validate_iban": {
        "iban": "ES76210004184502000051332"
      },
      "get_customer_by_msisdn": {
        "msisdn": "+34699111222"
      },
      "set_direct_debit": {
        "account_id": "ACC_FROM_MSISDN",
        "iban": "ES76210004184502000051332",
        "consent": true
      }
    },
    "complexity": "high"
  },
  {
    "id": "TC_009",
    "scenario": "estimate_next_bill_with_addon",
    "query": "Si añado el paquete de datos extra de 5GB por 10€, ¿cuánto me saldría aproximadamente la próxima factura? Mi cuenta es ACC-00998877.",
    "available_tools": [
      {
        "type": "function",
        "function": {
          "name": "get_latest_invoice",
          "description": "Retrieves the most recent invoice metadata for a given account.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              }
            },
            "required": [
              "account_id"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_current_plan_charges",
          "description": "Returns recurring monthly charges and active add-ons for an account.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              }
            },
            "required": [
              "account_id"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "estimate_next_invoice_total",
          "description": "Estimates next invoice total based on current recurring charges and optional add-ons.",
          "parameters": {
            "type": "object",
            "properties": {
              "account_id": {
                "type": "string",
                "description": "Movistar billing account identifier"
              },
              "add_on_codes": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Optional add-on product codes to include in the estimate"
              }
            },
            "required": [
              "account_id"
            ]
          }
        }
      }
    ],
    "expected_tool_calls": [
      "estimate_next_invoice_total"
    ],
    "expected_parameters": {
      "estimate_next_invoice_total": {
        "account_id": "ACC-00998877",
        "add_on_codes": [
          "ADDON_DATA_5GB_10EUR"
        ]
      }
    },
    "complexity": "medium"
  },
  {
    "id": "TC_010",
    "scenario": "duplicate_charge_check",
    "query": "Creo que me han cobrado dos veces el mismo concepto en la factura. ¿Puedes revisarlo? El número de factura es F-2026-000123.",
    "available_tools": [
      {
        "type": "function",
        "function": {
          "name": "get_invoice_by_number",
          "description": "Retrieves invoice metadata using the invoice number shown on the bill.",
          "parameters": {
            "type": "object",
            "properties": {
              "invoice_number": {
                "type": "string",
                "description": "Invoice number, e.g., F-2026-000123"
              }
            },
            "required": [
              "invoice_number"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_invoice_itemization",
          "description": "Returns detailed line items (calls, data, roaming, services) for an invoice.",
          "parameters": {
            "type": "object",
            "properties": {
              "invoice_id": {
                "type": "string",
                "description": "Invoice identifier"
              },
              "category_filter": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Optional categories to filter"
              }
            },
            "required": [
              "invoice_id"
            ]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "detect_duplicate_charges",
          "description": "Analyzes invoice line items to detect potential duplicate charges.",
          "parameters": {
            "type": "object",
            "properties": {
              "invoice_id": {
                "type": "string",
                "description": "Invoice identifier"
              },
              "tolerance_amount": {
                "type": "number",
                "description": "Amount tolerance to consider charges duplicates (e.g., 0.01)"
              }
            },
            "required": [
              "invoice_id",
              "tolerance_amount"
            ]
          }
        }
      }
    ],
    "expected_tool_calls": [
      "get_invoice_by_number",
      "detect_duplicate_charges"
    ],
    "expected_parameters": {
      "get_invoice_by_number": {
        "invoice_number": "F-2026-000123"
      },
      "detect_duplicate_charges": {
        "invoice_id": "INVOICE_ID_FROM_NUMBER",
        "tolerance_amount": 0.01
      }
    },
    "complexity": "medium"
  }
]